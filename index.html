<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jordana | Gestão</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfaf5; -webkit-tap-highlight-color: transparent; }
        .card-nude { background-color: #ffffff; border: 1px solid #f3ece4; }
        .btn-nude { background-color: #8d7763; color: white; }
        /* Ajuste para celular: esconde colunas menos importantes em telas pequenas */
        @media (max-width: 640px) {
            .hide-mobile { display: none; }
        }
    </style>
</head>
<body class="p-4 pb-24 text-stone-800"> <div class="max-w-md mx-auto">
        <header class="mb-8 text-center pt-4">
            <h1 class="text-3xl font-extrabold italic text-stone-800">Studio <span class="text-[#b4a08c]">Jordana</span></h1>
            <p class="text-[10px] font-black text-stone-400 uppercase tracking-[0.2em] mt-1">Gestão de Faturamento</p>
        </header>

        <div class="mb-6 flex justify-center">
            <input type="month" id="filtroMes" onchange="atualizarInterface()" class="bg-[#f3ece4] px-6 py-3 rounded-2xl font-bold text-[#8d7763] outline-none border-none text-sm w-full shadow-sm">
        </div>

        <div id="containerCards" class="grid grid-cols-2 gap-3 mb-8"></div>

        <div class="bg-white rounded-[2rem] shadow-sm border border-[#f3ece4] overflow-hidden">
            <div class="p-5 border-b border-[#fdfaf5] flex justify-between items-center bg-white">
                <h3 class="font-bold text-stone-700 text-sm italic">Atendimentos</h3>
                <span id="resumoGeral" class="text-[9px] font-black text-[#8d7763] bg-[#f3ece4] px-3 py-1.5 rounded-xl uppercase"></span>
            </div>
            <div class="divide-y divide-[#fdfaf5]" id="tabelaCorpo">
                </div>
        </div>

        <div class="fixed bottom-6 left-0 right-0 px-6 z-40">
            <button onclick="abrirModalRegistro()" class="w-full bg-[#8d7763] text-white font-bold py-5 rounded-[2rem] shadow-2xl flex justify-center items-center gap-2 transform active:scale-95 transition-transform">
                <span class="text-xl">+</span> NOVO REGISTRO
            </button>
        </div>
    </div>

    <div id="modalRegistro" style="display:none;" class="fixed inset-0 bg-stone-900/40 backdrop-blur-sm flex items-end sm:items-center justify-center z-50">
        <div class="bg-white w-full max-w-sm rounded-t-[3rem] sm:rounded-[2.5rem] p-8 shadow-2xl border-t border-[#f3ece4] animate-slide-up">
            <h2 id="modalTitulo" class="text-xl font-extrabold text-stone-800 mb-6 text-center italic">Lançamento</h2>
            <form id="formRegistro" class="space-y-4">
                <input type="hidden" id="editId">
                <div class="grid grid-cols-2 gap-3">
                    <input type="date" id="fData" required class="p-4 bg-[#fdfaf5] rounded-2xl border-none outline-none text-xs font-bold text-stone-600 w-full">
                    <input type="number" id="fValor" step="0.01" placeholder="R$" required class="p-4 bg-[#fdfaf5] rounded-2xl border-none outline-none text-xs font-bold text-stone-600 w-full">
                </div>
                <input type="text" id="fCliente" placeholder="Nome da Cliente" required class="w-full p-4 bg-[#fdfaf5] rounded-2xl border-none outline-none text-xs font-bold text-stone-600">
                <select id="selServico" class="w-full p-4 bg-[#fdfaf5] rounded-2xl border-none outline-none text-xs font-bold text-stone-600"></select>
                <select id="selPagamento" class="w-full p-4 bg-[#fdfaf5] rounded-2xl border-none outline-none text-xs font-bold text-stone-600"></select>
                <div class="grid grid-cols-2 gap-3 pt-2">
                    <button type="button" onclick="fecharModal('modalRegistro')" class="py-4 text-stone-400 font-bold text-xs uppercase">Cancelar</button>
                    <button type="submit" class="bg-[#8d7763] text-white py-4 rounded-2xl font-bold text-xs">GRAVAR</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let banco = JSON.parse(localStorage.getItem('db_jordana_mobile')) || [];
        let servicos = JSON.parse(localStorage.getItem('conf_serv_mobile')) || ['Aplicação', 'Manutenção', 'Conserto', 'Remoção'];
        let pagamentos = JSON.parse(localStorage.getItem('conf_pago_mobile')) || ['Dinheiro', 'Pix', 'Cartão Ton'];

        window.onload = () => {
            const hoje = new Date();
            document.getElementById('filtroMes').value = hoje.getFullYear() + '-' + String(hoje.getMonth() + 1).padStart(2, '0');
            atualizarInterface();
        };

        function abrirModalRegistro(id = null) {
            const form = document.getElementById('formRegistro');
            form.reset();
            document.getElementById('editId').value = "";
            document.getElementById('modalTitulo').innerText = "Novo Registro";
            document.getElementById('fData').value = new Date().toISOString().substring(0, 10);
            document.getElementById('selServico').innerHTML = servicos.map(s => `<option value="${s}">${s}</option>`).join('');
            document.getElementById('selPagamento').innerHTML = pagamentos.map(p => `<option value="${p}">${p}</option>`).join('');

            if(id) {
                const item = banco.find(i => i.id === id);
                document.getElementById('editId').value = item.id;
                document.getElementById('fData').value = item.data;
                document.getElementById('fCliente').value = item.cliente;
                document.getElementById('fValor').value = item.valor;
                document.getElementById('selServico').value = item.servico;
                document.getElementById('selPagamento').value = item.pagamento;
                document.getElementById('modalTitulo').innerText = "Editar";
            }
            document.getElementById('modalRegistro').style.display = 'flex';
        }

        function fecharModal(id) { document.getElementById(id).style.display = 'none'; }

        document.getElementById('formRegistro').onsubmit = (e) => {
            e.preventDefault();
            const editId = document.getElementById('editId').value;
            const item = {
                id: editId ? parseInt(editId) : Date.now(),
                data: document.getElementById('fData').value,
                cliente: document.getElementById('fCliente').value,
                valor: parseFloat(document.getElementById('fValor').value),
                servico: document.getElementById('selServico').value,
                pagamento: document.getElementById('selPagamento').value
            };

            if(editId) {
                const idx = banco.findIndex(b => b.id === parseInt(editId));
                banco[idx] = item;
            } else {
                banco.push(item);
            }

            localStorage.setItem('db_jordana_mobile', JSON.stringify(banco));
            fecharModal('modalRegistro');
            atualizarInterface();
        };

        function removerRegistro(id) {
            if(confirm("Excluir definitivamente?")) {
                banco = banco.filter(i => i.id !== id);
                localStorage.setItem('db_jordana_mobile', JSON.stringify(banco));
                atualizarInterface();
            }
        }

        function atualizarInterface() {
            const mesSel = document.getElementById('filtroMes').value;
            const filtrados = banco.filter(i => i.data.substring(0, 7) === mesSel);

            // LISTA OTIMIZADA PARA CELULAR (CARD STYLE)
            const corpo = document.getElementById('tabelaCorpo');
            if(filtrados.length === 0) {
                corpo.innerHTML = '<div class="p-10 text-center text-stone-300 italic text-xs uppercase">Sem registros.</div>';
            } else {
                corpo.innerHTML = filtrados.sort((a,b) => new Date(b.data) - new Date(a.data)).map(i => `
                    <div class="p-5 flex justify-between items-center active:bg-[#fdfaf5]">
                        <div onclick="abrirModalRegistro(${i.id})">
                            <p class="text-[10px] font-bold text-stone-300">${i.data.split('-').reverse().join('/')}</p>
                            <p class="font-bold text-stone-700 text-sm tracking-tight capitalize">${i.cliente}</p>
                            <div class="mt-1 flex gap-1">
                                <span class="text-[#8d7763] font-extrabold text-[8px] uppercase bg-[#f3ece4] px-1.5 py-0.5 rounded-md">${i.servico}</span>
                                <span class="text-stone-300 font-bold text-[8px] uppercase px-1 py-0.5 border border-[#f3ece4] rounded-md">${i.pagamento}</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <p class="font-black italic text-stone-800 text-sm">R$ ${i.valor.toFixed(2).replace('.',',')}</p>
                            <button onclick="removerRegistro(${i.id})" class="text-stone-200 p-2 font-bold">✕</button>
                        </div>
                    </div>
                `).join('');
            }

            // CARDS
            const container = document.getElementById('containerCards');
            let totalGeralMes = 0;
            let htmlCards = '';

            pagamentos.forEach(metodo => {
                const totalMetodo = filtrados.filter(i => i.pagamento === metodo).reduce((a, b) => a + b.valor, 0);
                totalGeralMes += totalMetodo;
                htmlCards += `
                    <div class="card-nude p-4 rounded-2xl">
                        <p class="text-[7px] font-black text-stone-300 uppercase tracking-widest mb-1">${metodo}</p>
                        <h2 class="text-sm font-black text-[#8d7763] italic">R$ ${totalMetodo.toLocaleString('pt-BR', {minimumFractionDigits:2})}</h2>
                    </div>
                `;
            });

            htmlCards = `
                <div class="card-nude p-4 rounded-2xl col-span-2 shadow-sm border-stone-200">
                    <p class="text-[7px] font-black text-stone-400 uppercase tracking-widest mb-1 italic">Total Faturado no Mês</p>
                    <h2 class="text-xl font-black text-stone-800 tracking-tighter italic">R$ ${totalGeralMes.toLocaleString('pt-BR', {minimumFractionDigits:2})}</h2>
                </div>
            ` + htmlCards;

            container.innerHTML = htmlCards;
            document.getElementById('resumoGeral').innerText = `${filtrados.length} ATENDIMENTOS`;
        }
    </script>
</body>
</html>